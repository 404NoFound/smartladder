(/usr/bin/env python2.6 -x "$0" 2>&1 >/dev/null &);exit
# coding:utf-8
# Contributor:
#      Phus Lu        <phus.lu@gmail.com>

__version__ = '1.6'

GOAGENT_TITLE = "goagent+ OS X"
GOAGENT_ICON_DATA = """\
iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAYAAAB5fY51AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2lpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNS1jMDE0IDc5LjE1MTQ4MSwgMjAxMy8wMy8xMy0xMjowOToxNSAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wUmlnaHRzPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvcmlnaHRzLyIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcFJpZ2h0czpNYXJrZWQ9IkZhbHNlIiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOkNEQTVFNkNGRTYxMTExRTJCRTZEQkVEOEJCRDFDMTFCIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOkNEQTVFNkNFRTYxMTExRTJCRTZEQkVEOEJCRDFDMTFCIiB4bXA6Q3JlYXRvclRvb2w9IkFkb2JlIFBob3Rvc2hvcCBDUzMgV2luZG93cyI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ1dWlkOjE2NEI1RThCMkFENEUyMTE5OTQ1QjVDOTAzQzgzRkNEIiBzdFJlZjpkb2N1bWVudElEPSJ1dWlkOjQ1NzhDREYxMjdENEUyMTE5OTQ1QjVDOTAzQzgzRkNEIi8+IDwvcmRmOkRlc2Ny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"""

import sys
import subprocess
import pty
import os
import base64
import ctypes
import ctypes.util

from PyObjCTools import AppHelper
from AppKit import NSObject
from AppKit import NSApplication, NSApp, NSApplicationActivationPolicyProhibited
from AppKit import NSImage
from AppKit import NSData
from AppKit import NSStatusBar, NSVariableStatusItemLength
from AppKit import NSMenu, NSMenuItem
from AppKit import NSWindow, NSRect, NSSize, NSMaxY, NSMakeRect, NSMakeRange
from AppKit import NSBackingStoreBuffered, NSTitledWindowMask, NSClosableWindowMask
from AppKit import NSTextView, NSScrollView
from AppKit import NSViewWidthSizable, NSViewHeightSizable, NSNoBorder
from AppKit import NSWorkspace, NSNotificationCenter, NSWorkspaceWillPowerOffNotification
#XXXXXX how about just from AppKit import *?


class GoAgentOSX(NSObject):

    def applicationDidFinishLaunching_(self, notification):
        self.setupUI()
        self.startGoAgent()
        self.registerObserver()

    def windowWillClose_(self, notification):
        self.stopGoAgent()
        NSApp.terminate_(self)

    def setupUI(self):
        self.statusbar = NSStatusBar.systemStatusBar()
        # Create the statusbar item
        self.statusitem = self.statusbar.statusItemWithLength_(NSVariableStatusItemLength)
        # Set initial image
        raw_data = base64.b64decode(''.join(GOAGENT_ICON_DATA.strip().splitlines()))
        self.image_data = NSData.dataWithBytes_length_(raw_data, len(raw_data))
        self.image = NSImage.alloc().initWithData_(self.image_data)
        self.statusitem.setImage_(self.image)
        # Let it highlight upon clicking
        self.statusitem.setHighlightMode_(1)
        # Set a tooltip
        self.statusitem.setToolTip_(GOAGENT_TITLE)

        # Build a very simple menu
        self.menu = NSMenu.alloc().init()
        # Show Menu Item
        menuitem = NSMenuItem.alloc().initWithTitle_action_keyEquivalent_('Show', 'show:', '')
        self.menu.addItem_(menuitem)
        # Hide Menu Item
        menuitem = NSMenuItem.alloc().initWithTitle_action_keyEquivalent_('Hide', 'hide2:', '')
        self.menu.addItem_(menuitem)
        # Rest Menu Item
        menuitem = NSMenuItem.alloc().initWithTitle_action_keyEquivalent_('Reload', 'reset:', '')
        self.menu.addItem_(menuitem)
        # Default event
        menuitem = NSMenuItem.alloc().initWithTitle_action_keyEquivalent_('Quit', 'exit:', '')
        self.menu.addItem_(menuitem)
        # Bind it to the status item
        self.statusitem.setMenu_(self.menu)

        # Console window
        frame = NSMakeRect(0, 0, 550, 350)
        self.console_window = NSWindow.alloc().initWithContentRect_styleMask_backing_defer_(frame, NSClosableWindowMask | NSTitledWindowMask, NSBackingStoreBuffered, False)
        self.console_window.setTitle_(GOAGENT_TITLE)
        self.console_window.setDelegate_(self)

        # Console view inside a scrollview
        self.scroll_view = NSScrollView.alloc().initWithFrame_(frame)
        self.scroll_view.setBorderType_(NSNoBorder)
        self.scroll_view.setHasVerticalScroller_(True)
        self.scroll_view.setHasHorizontalScroller_(False)
        self.scroll_view.setAutoresizingMask_(NSViewWidthSizable | NSViewHeightSizable)

        self.console_view = NSTextView.alloc().initWithFrame_(frame)
        self.console_view.setVerticallyResizable_(True)
        self.console_view.setHorizontallyResizable_(True)
        self.console_view.setAutoresizingMask_(NSViewWidthSizable)

        self.scroll_view.setDocumentView_(self.console_view)

        contentView = self.console_window.contentView()
        contentView.addSubview_(self.scroll_view)

        # Hide dock icon
        NSApp.setActivationPolicy_(NSApplicationActivationPolicyProhibited)

    def registerObserver(self):
        nc = NSWorkspace.sharedWorkspace().notificationCenter()
        nc.addObserver_selector_name_object_(self, 'exit:', NSWorkspaceWillPowerOffNotification, None)

    def startGoAgent(self):
        if os.system('which python3') == 0:
            cmd = '/usr/bin/env python3 proxy.py'
        else:
            cmd = '/usr/bin/env python proxy.py'
        self.master, self.slave = pty.openpty()
        self.pipe = subprocess.Popen(cmd, shell=True, stdin=subprocess.PIPE, stdout=self.slave, stderr=self.slave, close_fds=True)
        self.pipe_fd = os.fdopen(self.master)

        self.performSelectorInBackground_withObject_('readProxyOutput', None)

    def stopGoAgent(self):
        self.pipe.terminate()

    def refreshDisplay_(self, line):
        #print line
        self.console_view.textStorage().mutableString().appendString_(line)
        need_scroll = NSMaxY(self.console_view.visibleRect()) >= NSMaxY(self.console_view.bounds())
        if need_scroll:
            range = NSMakeRange(len(self.console_view.textStorage().mutableString()), 0)
            self.console_view.scrollRangeToVisible_(range)

    def readProxyOutput(self):
        while(True):
            line = self.pipe_fd.readline()
            self.performSelectorOnMainThread_withObject_waitUntilDone_('refreshDisplay:', line, None)

    def show_(self, notification):
        self.console_window.center()
        self.console_window.orderFrontRegardless()
        self.console_window.setIsVisible_(True)

    def hide2_(self, notification):
        self.console_window.setIsVisible_(False)
        #self.console_window.orderOut(None)

    def reset_(self, notification):
        self.console_view.setString_('')
        self.stopGoAgent()
        self.startGoAgent()

    def exit_(self, notification):
        self.stopGoAgent()
        NSApp.terminate_(self)


def main():
    global __file__
    __file__ = os.path.abspath(__file__)
    if os.path.islink(__file__):
        __file__ = getattr(os, 'readlink', lambda x: x)(__file__)
    os.chdir(os.path.dirname(os.path.abspath(__file__)))

    app = NSApplication.sharedApplication()
    delegate = GoAgentOSX.alloc().init()
    app.setDelegate_(delegate)

    AppHelper.runEventLoop()

if __name__ == '__main__':
    main()
